<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시:그널 - 민원 작성</title>

    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>

<div th:replace="~{layout/header :: header}"></div>

<main class="container container-narrow">

    <div style="margin-bottom: 30px;">
        <h2 style="margin-bottom: 10px; color: var(--primary-color);">✍️ 민원 작성</h2>
        <p style="color: var(--text-light); margin: 0;">여러분의 제보가 시흥을 바꿉니다. 정확한 정보를 입력해주세요.</p>
    </div>

    <form method="post" th:action="@{/complaints/new}" class="form-box" enctype="multipart/form-data">

        <div class="form-group">
            <label>카테고리 <span style="color:red">*</span></label>
            <select name="category" class="form-control" required>
                <option value="">카테고리를 선택하세요</option>

                <option value="도로" th:selected="${savedCat == '도로'}">🚧 도로/시설</option>
                <option value="교통" th:selected="${savedCat == '교통'}">🚌 교통</option>
                <option value="환경" th:selected="${savedCat == '환경'}">🌳 환경/청소</option>
                <option value="안전" th:selected="${savedCat == '안전'}">👮 안전</option>
                <option value="기타" th:selected="${savedCat == '기타'}">📝 기타</option>
            </select>
        </div>

        <div class="form-group">
            <label>민원 제목 <span style="color:red">*</span></label>
            <input type="text" name="title" class="form-control" placeholder="불편 사항을 요약해주세요 (예: 정왕동 도로 파손 신고)" required>
        </div>

        <div class="form-group">
            <label>위치 (주소 검색) <span style="color:red">*</span></label>

            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <input type="text" id="address" name="location" class="form-control" placeholder="주소를 검색해주세요" readonly required>
                <button type="button" onclick="execDaumPostcode()" class="btn-submit" style="width: 120px; background: #666; margin: 0;">
                    🔍 검색
                </button>
            </div>

            <input type="text" id="detailAddress" name="locationDetail" class="form-control" placeholder="상세 위치를 입력해주세요 (예: 1층 편의점 앞, 버스정류장 옆)">
        </div>

        <div class="form-group">
            <label>현장 사진 첨부 (선택)</label>
            <input type="file" name="files" class="form-control" accept="image/*" multiple>
            <p class="text-sub" style="margin-top: 8px;">
                * 이미지만 업로드 가능하며, 최대 3장까지 첨부할 수 있습니다.<br>
                * 현장 상황을 잘 알 수 있는 사진을 첨부해주세요.
            </p>
        </div>

        <div class="form-group">
            <label>상세 내용 <span style="color:red">*</span></label>
            <textarea name="content" class="form-control" rows="8" placeholder="불편 사항을 구체적으로 작성해주세요.&#13;&#10;(언제, 어디서, 무엇을 목격하셨나요?)" required></textarea>
        </div>

        <div class="form-group" style="background: #f9f9f9; padding: 15px; border-radius: 6px; margin-top: 30px;">
            <label style="font-weight: normal; font-size: 0.95rem; display: flex; align-items: center; cursor: pointer; margin-bottom: 0;">
                <input type="checkbox" name="agree" required style="width: auto; margin-right: 10px; transform: scale(1.2);">
                <span>[필수] 민원 처리를 위한 개인정보 수집 및 이용에 동의합니다.</span>
            </label>
        </div>

        <hr class="divider" style="margin: 30px 0;">

        <div style="display: flex; gap: 10px;">
            <a href="/complaints/list" class="btn-submit" style="background: #e0e0e0; color: #333; text-decoration: none; text-align: center; flex: 1;">
                취소
            </a>
            <button type="submit" class="btn-submit" style="flex: 2;">
                민원 등록하기
            </button>
        </div>

    </form>
</main>

<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
    function execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.
                var addr = ''; // 주소 변수

                // 사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                if (data.userSelectedType === 'R') { // 도로명 주소
                    addr = data.roadAddress;
                } else { // 지번 주소
                    addr = data.jibunAddress;
                }

                // 건물명이 있고, 공동주택일 경우 추가한다.
                if(data.buildingName !== '' && data.apartment === 'Y'){
                   addr += ' (' + data.buildingName + ')';
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById("address").value = addr;

                // 상세주소 칸으로 커서를 이동한다.
                document.getElementById("detailAddress").focus();
            }
        }).open();
    }
</script>

</body>
</html>